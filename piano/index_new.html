<!DOCTYPE html>
<html lang="zh">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ç”µå­é’¢ç´</title>
    <style>
        body {
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            margin: 0;
            font-family: Arial, sans-serif;
            overflow: hidden;
            position: relative;
        }

        /* èƒŒæ™¯å›¾ç‰‡ */
        .bg-image {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-image: url('12.jpg');
            background-size: cover;
            background-position: center;
            z-index: -3;
            transition: transform 0.5s ease-out;
            /* ç¡®ä¿èƒŒæ™¯å›¾ç‰‡è¦†ç›–æ•´ä¸ªå±å¹• */
            min-height: 100vh;
            min-width: 100vw;
            object-fit: cover;
        }

        /* è§†å·®æ˜Ÿæ˜Ÿå±?*/
        .stars-layer {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: -2;
            pointer-events: none;
        }

        .star {
            position: absolute;
            background-color: #fff;
            border-radius: 50%;
            opacity: 0;
            box-shadow: 0 0 var(--glow-size) var(--glow-color);
            animation: twinkle var(--duration) infinite ease-in-out;
        }

        @keyframes twinkle {
            0%, 100% { opacity: 0; transform: scale(0.8); }
            50% { opacity: var(--opacity); transform: scale(1); }
        }

        /* å…‰å¸¦åŠ¨ç”» */
        .light-ribbon {
            position: absolute;
            height: 2px;
            background: linear-gradient(90deg, transparent, var(--ribbon-color), transparent);
            z-index: -1;
            opacity: 0.7;
            filter: blur(1px);
            transform-origin: left center;
            animation: ribbon-flow 8s infinite ease-in-out;
        }

        @keyframes ribbon-flow {
            0% { transform: scaleX(0) translateY(0) rotate(var(--angle)); opacity: 0; }
            10% { opacity: 0.7; }
            90% { opacity: 0.7; }
            100% { transform: scaleX(1) translateY(var(--shift)) rotate(var(--angle)); opacity: 0; }
        }

        /* æµæ˜Ÿæ•ˆæœ - å…¨æ–°è®¾è®¡ */
        .comet {
            position: absolute;
            width: 3px;
            height: 3px;
            background: rgba(255, 255, 255, 0.9);
            border-radius: 50%;
            z-index: -1;
            opacity: 1;
            transform-origin: center center;
            box-shadow: none;
        }

        /* åŸºç¡€å°¾è¿¹ */
        .comet::before {
            content: '';
            position: absolute;
            top: 50%;
            width: var(--tail-length, 100px);
            height: 1px;
            background: linear-gradient(to left, rgba(255, 255, 255, 0.8), transparent);
            transform: translateY(-50%);
            left: 2px;
            border-radius: 0;
            filter: none;
        }

        /* ä¸å†ä½¿ç”¨é¢å¤–å½©è‰²å°¾è¿¹ */
        .comet::after {
            display: none;
        }

        /* è½»é‡å‹æµæ˜?- ç®€å•æ¸…æ™?*/
        .comet.light {
            width: 2px;
            height: 2px;
            background: rgba(255, 255, 255, 0.8);
        }
        
        .comet.light::before {
            height: 1px;
            width: var(--tail-length, 80px);
            background: linear-gradient(to left, rgba(255, 255, 255, 0.7), transparent);
        }
        
        /* æ ‡å‡†æµæ˜Ÿ */
        .comet.standard {
            width: 3px;
            height: 3px;
        }
        
        .comet.standard::before {
            height: 1px;
            width: var(--tail-length, 120px);
        }
        
        /* é•¿å°¾æµæ˜Ÿ */
        .comet.long {
            width: 3px;
            height: 3px;
        }
        
        .comet.long::before {
            width: var(--tail-length, 200px);
            background: linear-gradient(to left, rgba(255, 255, 255, 0.8), rgba(255, 255, 255, 0.4), transparent);
        }
        
        /* è“è°ƒæµæ˜Ÿ */
        .comet.blue {
            width: 3px;
            height: 3px;
            background-color: rgba(220, 240, 255, 0.9);
        }
        
        .comet.blue::before {
            background: linear-gradient(to left, rgba(220, 240, 255, 0.8), rgba(135, 206, 250, 0.4), transparent);
        }
        
        /* æµæ˜Ÿå®¹å™¨ - ç®¡ç†åŠ¨ç”»å¯¹è±¡ */
        .comet-container {
            position: absolute;
            pointer-events: none;
            z-index: -1;
        }

        /* æ—¥å‡º/æ—¥è½å…‰æ™•æ•ˆæœ */
        .horizon-glow {
            position: fixed;
            bottom: 0;
            left: 0;
            width: 100%;
            height: 40%;
            background: radial-gradient(ellipse at center bottom, 
                rgba(255, 175, 125, 0.2) 0%, 
                rgba(255, 110, 50, 0.1) 30%, 
                rgba(0, 0, 0, 0) 70%);
            z-index: -2;
            animation: horizon-pulse 10s infinite alternate;
        }

        @keyframes horizon-pulse {
            0% { opacity: 0.7; }
            100% { opacity: 1; }
        }

        /* è“ç²‰è‰²å…‰å¸?*/
        .special-ribbons {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: -1;
            pointer-events: none;
        }

        /* é’¢ç´å®¹å™¨æ ·å¼ */
        .piano-container {
            position: relative;
            padding: 30px;
            padding-bottom: 80px;  /* å¢åŠ åº•éƒ¨ç©ºé—´ */
            background: linear-gradient(to bottom, rgba(20, 20, 40, 0.7) 0%, rgba(10, 10, 30, 0.8) 100%);
            border-radius: 10px;
            box-shadow: 0 0 30px rgba(138, 43, 226, 0.2), 0 10px 50px rgba(0,0,0,0.5);
            border: 1px solid rgba(100, 100, 150, 0.4);
            backdrop-filter: blur(5px);
            z-index: 1;
        }

        /* é’¢ç´è¾¹ç¼˜çš„å‘å…‰æ•ˆæ?*/
        .piano-container::before {
            content: '';
            position: absolute;
            top: -2px;
            left: -2px;
            right: -2px;
            bottom: -2px;
            background: linear-gradient(45deg, 
                transparent 0%, 
                rgba(0, 162, 255, 0.3) 25%, 
                transparent 50%, 
                rgba(255, 41, 117, 0.3) 75%, 
                transparent 100%);
            z-index: -1;
            border-radius: 12px;
            animation: border-glow 10s linear infinite;
        }

        @keyframes border-glow {
            0% { filter: hue-rotate(0deg); }
            100% { filter: hue-rotate(360deg); }
        }

        .piano {
            display: flex;
            position: relative;
            padding: 20px 20px 40px 20px;
            background: #1a1a1a;
            border-radius: 5px;
            box-shadow: inset 0 5px 15px rgba(0,0,0,0.5);
        }

        .key {
            width: 60px;
            height: 220px;
            background: linear-gradient(to bottom, #fff 0%, #eee 75%, #ddd 100%);
            border: 1px solid #ccc;
            border-radius: 0 0 6px 6px;
            cursor: pointer;
            position: relative;
            user-select: none;
            transition: transform 0.08s cubic-bezier(0.2, 0.8, 0.3, 1.2), 
                        background 0.15s ease-in-out,
                        box-shadow 0.15s ease-in-out,
                        border 0.15s ease-in-out;
            /* ç§»é™¤é«˜åº¦è¿‡æ¸¡ï¼Œé˜²æ­¢å¼•èµ·è·³åŠ?*/
            box-shadow: 0 5px 10px rgba(0,0,0,0.2), inset 0 -1px 0 rgba(255,255,255,0.7);
            margin: 0 -1px;
            z-index: 1;
            /* æ·»åŠ ç›¸å¯¹å®šä½å®¹å™¨ï¼Œä»¥ä¾¿å†…éƒ¨å…ƒç´ ä½¿ç”¨ç»å¯¹å®šä½è¿›è¡ŒåŠ¨ç”?*/
            transform-style: preserve-3d;
        }

        /* é”®ç›˜é‡Šæ”¾æ—¶çš„è¿‡æ¸¡æ•ˆæœæ ·å¼ */
        .key-releasing {
            transition: all 0.15s cubic-bezier(0, 0, 0.3, 1.3);
        }

        .key::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 15px;
            background: linear-gradient(to bottom, #fff 0%, #f6f6f6 100%);
            border-radius: 2px 2px 0 0;
        }

        .key.black {
            width: 36px;
            height: 140px;
            background: linear-gradient(to bottom, #444 0%, #222 75%, #000 100%);
            position: absolute;
            margin-left: -18px;
            z-index: 2;
            border: 1px solid #000;
            border-radius: 0 0 4px 4px;
            box-shadow: 0 3px 6px rgba(0,0,0,0.8), inset 0 -1px 0 rgba(255,255,255,0.1);
            transform-style: preserve-3d;
            transition: transform 0.08s cubic-bezier(0.2, 0.8, 0.3, 1.2), 
                        background 0.15s ease-in-out,
                        box-shadow 0.15s ease-in-out,
                        border 0.15s ease-in-out;
            /* ç§»é™¤é«˜åº¦è¿‡æ¸¡ï¼Œé˜²æ­¢å¼•èµ·è·³åŠ?*/
        }

        .key.black::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 8px;
            background: linear-gradient(to bottom, #666 0%, #333 100%);
            border-radius: 2px 2px 0 0;
        }

        /* ç‰¹æ®Šçš„é»‘é”®å¸ƒå±€ */
        .key[data-note="C#4"], .key[data-note="D#4"] {
            left: calc(50% - 30%);
        }

        .key[data-note="F#4"], .key[data-note="G#4"], .key[data-note="A#4"] {
            left: calc(50% + 30%);
        }

        /* æŒ‰é”®æŒ‰ä¸‹æ•ˆæœï¼ˆè§†è§‰å±‚ï¼?/
        .key-pressed-effect {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            z-index: 3;
            pointer-events: none;
            background: none;
            transform: translateY(3px);
            opacity: 0;
            transition: opacity 0.1s;
        }

        .key.active {
            background: linear-gradient(to bottom, #f0f0f0 0%, #e0e0e0 75%, #d0d0d0 100%);
            /* ç§»é™¤transformï¼Œé˜²æ­¢æ•´ä½“è·³åŠ?*/
            transform: none;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1), inset 0 -1px 0 rgba(255,255,255,0.5);
            /* ä¸å†æ”¹å˜é«˜åº¦ï¼Œé˜²æ­¢æ•´ä½“ç»“æ„å˜åŒ?*/
            height: 220px;
            position: relative;
            overflow: hidden;
        }
        
        /* æ·»åŠ æŒ‰é”®æŒ‰ä¸‹æ—¶çš„3Dé˜´å½±æ•ˆæœæ›¿ä»£ä½ç§» */
        .key.active::before {
            box-shadow: inset 0 2px 3px rgba(0,0,0,0.2);
        }
        
        /* ä½¿ç”¨ä¼ªå…ƒç´ æ·»åŠ æŒ‰ä¸‹æ•ˆæ?*/
        .key.active::after {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: radial-gradient(circle at center, rgba(255,255,255,0.8) 0%, rgba(255,255,255,0) 70%);
            animation: key-glow 0.5s ease-out;
            pointer-events: none;
            z-index: 3;
        }

        @keyframes key-glow {
            0% { opacity: 0.7; transform: scale(0.2); }
            100% { opacity: 0; transform: scale(2); }
        }

        /* é»‘é”®æŒ‰ä¸‹æ•ˆæœæ ·å¼ */
        .key.black.active {
            background: linear-gradient(to bottom, #444 0%, #333 75%, #222 100%);
            /* ç§»é™¤transformï¼Œé˜²æ­¢æ•´ä½“è·³åŠ?*/
            transform: none;
            box-shadow: 0 1px 3px rgba(0,0,0,0.3), inset 0 -1px 0 rgba(255,255,255,0.1);
            /* ä¸å†æ”¹å˜é«˜åº¦ï¼Œé˜²æ­¢æ•´ä½“ç»“æ„å˜åŒ?*/
            height: 140px;
            overflow: hidden;
            opacity: 1; /* ç¡®ä¿é»‘é”®ä¸ä¼šå˜é€æ˜ */
        }
        
        /* æ·»åŠ æŒ‰é”®æŒ‰ä¸‹æ—¶çš„3Dé˜´å½±æ•ˆæœæ›¿ä»£ä½ç§» */
        .key.black.active::before {
            box-shadow: inset 0 2px 3px rgba(0,0,0,0.3);
            background: linear-gradient(to bottom, #555 0%, #333 100%);
        }

        .key.black.active::after {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: radial-gradient(circle at center, rgba(180,180,255,0.5) 0%, rgba(100,100,200,0) 70%);
            animation: black-key-glow 0.5s ease-out;
            pointer-events: none;
            z-index: 3;
        }
        
        @keyframes black-key-glow {
            0% { opacity: 0.8; transform: scale(0.2); }
            100% { opacity: 0; transform: scale(2); }
        }

        /* æ·»åŠ é”®ç›˜æŒ‰é”®çš„è„‰åŠ¨è¾¹æ¡?*/
        .key.active {
            border: 1px solid rgba(100, 200, 255, 0.4);
        }

        .key.black.active {
            border: 1px solid rgba(130, 130, 255, 0.6);
        }

        /* é”®ç›˜é«˜äº®æç¤ºæ•ˆæœ */
        .key-label {
            position: absolute;
            bottom: 5px;
            font-size: 12px;
            color: rgba(255, 255, 255, 0.5);
            font-weight: bold;
            text-align: center;
            width: 100%;
        }
        
        .black .key-label {
            color: rgba(200, 220, 255, 0.7);
            bottom: 10px;
        }
        
        .key:hover .key-label {
            color: rgba(255, 255, 255, 0.9);
        }
        
        /* ä¿®æ”¹ï¼šæ´»è·ƒçŠ¶æ€ä¸‹é”®ç›˜æ ‡ç­¾ä¸å†å®Œå…¨é€æ˜ï¼Œè€Œæ˜¯æ›´äº® */
        .key.active .key-label {
            color: rgba(255, 255, 255, 0.7);
        }
        
        .key.black.active .key-label {
            color: rgba(200, 220, 255, 0.8);
        }
        
        .pedal {
            width: 120px;
            height: 25px;
            background: linear-gradient(to bottom, #666 0%, #333 100%);
            position: absolute;
            bottom: 45px;  /* è°ƒæ•´ä½ç½®ï¼Œè®©å‡ºåº•éƒ¨æ–‡å­—çš„ç©ºé—´ */
            left: 50%;
            transform: translateX(-50%);
            border-radius: 5px;
            cursor: pointer;
            box-shadow: 0 3px 5px rgba(0,0,0,0.5), inset 0 1px 0 rgba(255,255,255,0.2);
            transition: all 0.1s;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 12px;
            color: #fff;
            text-shadow: 0 1px 1px rgba(0,0,0,0.8);
            white-space: nowrap;
            border: 1px solid #222;
        }

        .pedal.active {
            background: linear-gradient(to bottom, #555 0%, #222 100%);
            transform: translateX(-50%) translateY(2px);
            box-shadow: 0 1px 2px rgba(0,0,0,0.3), inset 0 1px 0 rgba(255,255,255,0.1);
        }

        .piano-info {
            color: #ccc;
            text-align: center;
            margin-top: 5px;
            position: absolute;
            bottom: 15px;
            left: 0;
            right: 0;
            font-size: 12px;
            text-shadow: 0 1px 2px rgba(0,0,0,0.5);
        }

        /* é’¢ç´æœ¨è´¨å¤–å£³æ•ˆæœ */
        .piano::before {
            content: '';
            position: absolute;
            top: -15px;
            left: -5px;
            right: -5px;
            height: 20px;
            background: linear-gradient(to bottom, #3c2210 0%, #5e381b 100%);
            border-radius: 5px 5px 0 0;
            border-bottom: 2px solid #2a1a0e;
        }

        .piano::after {
            content: '';
            position: absolute;
            bottom: -15px;
            left: -5px;
            right: -5px;
            height: 20px;
            background: linear-gradient(to top, #3c2210 0%, #5e381b 100%);
            border-radius: 0 0 5px 5px;
            border-top: 2px solid #2a1a0e;
        }

        /* éŸ³ç¬¦åŠ¨ç”» */
        .note-anim {
            position: absolute;
            z-index: 10;
            font-size: 24px;
            left: 50%;
            bottom: 60%;
            transform: translate(-50%, 0) scale(var(--scale)) rotate(var(--rotate));
            animation: float-up 1.5s ease-out;
            pointer-events: none;
            opacity: 0;
            user-select: none;
            will-change: transform, opacity;
        }
        
        @keyframes float-up {
            0% {
                transform: translate(calc(-50% + var(--x-offset)), var(--y-offset)) scale(var(--scale)) rotate(var(--rotate));
                opacity: 0.9;
            }
            100% {
                transform: translate(calc(-50% + var(--x-offset) * 1.8), -80px) scale(calc(var(--scale) * 1.3)) rotate(calc(var(--rotate) * 2));
                opacity: 0;
            }
        }

        /* é›ªç²’æ•ˆæœ - å–ä»£æµæ˜Ÿ */
        .snowflake {
            position: absolute;
            background-color: #fff;
            border-radius: 50%;
            z-index: -1;
            opacity: 0.9;
            box-shadow: 0 0 3px rgba(255, 255, 255, 0.8);
            pointer-events: none;
        }
        
        /* å°å‹é›ªç²’ */
        .snowflake.tiny {
            width: 2px;
            height: 2px;
            opacity: 0.7;
            filter: blur(0.3px);
        }
        
        /* æ™®é€šé›ªç²?*/
        .snowflake.normal {
            width: 4px;
            height: 4px;
            filter: blur(0.5px);
        }
        
        /* å¤§å‹é›ªç²’ */
        .snowflake.large {
            width: 6px;
            height: 6px;
            filter: blur(1px);
        }
        
        /* é—ªå…‰é›ªç²’ */
        .snowflake.sparkle {
            width: 4px;
            height: 4px;
            background-color: rgba(220, 240, 255, 0.95);
            box-shadow: 0 0 4px rgba(170, 220, 255, 0.9);
            filter: blur(0.5px);
        }
        
        /* é›ªç²’å®¹å™¨ */
        .snowflake-container {
            position: absolute;
            pointer-events: none;
            z-index: -1;
            width: 100%;
            height: 100%;
            top: 0;
            left: 0;
        }

        /* æ·»åŠ é”®ç›˜æŒ‰é”®å‹ä¸‹æ—¶çš„é€Ÿåº¦æ„?*/
        .key {
            transition: transform 0.08s cubic-bezier(0.2, 0.8, 0.3, 1.2), 
                        background 0.15s ease-in-out,
                        box-shadow 0.15s ease-in-out,
                        border 0.15s ease-in-out;
            /* ç§»é™¤é«˜åº¦è¿‡æ¸¡ï¼Œé˜²æ­¢å¼•èµ·è·³åŠ?*/
        }

        .key.black {
            transition: transform 0.08s cubic-bezier(0.2, 0.8, 0.3, 1.2), 
                        background 0.15s ease-in-out,
                        box-shadow 0.15s ease-in-out,
                        border 0.15s ease-in-out;
            /* ç§»é™¤é«˜åº¦è¿‡æ¸¡ï¼Œé˜²æ­¢å¼•èµ·è·³åŠ?*/
        }

        /* æ·»åŠ ã€Šæ™´å¤©ã€‹é”®ç›˜æŒ‡å¯¼æ ·å¼?*/
        .song-guide {
            margin-top: 20px;
            background: rgba(10, 10, 30, 0.7);
            border-radius: 8px;
            padding: 15px;
            color: #fff;
            font-size: 14px;
            text-align: center;
            border: 1px solid rgba(100, 100, 150, 0.3);
        }
        
        .song-guide h3 {
            margin: 0 0 10px 0;
            font-size: 16px;
            color: #9dd1ff;
            text-shadow: 0 0 5px rgba(100, 180, 255, 0.5);
        }
        
        .song-notes {
            line-height: 1.6;
            margin-bottom: 10px;
        }
        
        .note-highlight {
            color: #ffb8de;
            font-weight: bold;
        }
        
        /* æ·»åŠ é•¿çŸ­éŸ³ç¬¦çš„æ ·å¼?*/
        .long-note {
            color: #88ffff;
            font-weight: bold;
            padding: 2px 4px;
            border-radius: 3px;
            background: rgba(0, 150, 200, 0.2);
            margin: 0 2px;
        }
        
        .short-note {
            color: #ffcc88;
            font-weight: bold;
            padding: 2px 4px;
            border-radius: 3px;
            background: rgba(200, 100, 0, 0.2);
            margin: 0 2px;
        }
        
        .pause-note {
            color: #aaaaaa;
            padding: 2px 6px;
            margin: 0 2px;
        }
        
        .rhythm-mark {
            font-family: 'Arial Unicode MS', Arial, sans-serif;
            letter-spacing: 2px;
            color: #ffdd99;
        }
        
        .playing-tip {
            font-size: 12px;
            color: #cccccc;
            background: rgba(50, 50, 80, 0.4);
            padding: 6px;
            border-radius: 4px;
            margin-bottom: 10px;
        }
        
        .playing-tutorial {
            margin-top: 15px;
            background: rgba(50, 50, 80, 0.4);
            padding: 10px;
            border-radius: 4px;
            text-align: left;
            font-size: 13px;
            line-height: 1.8;
        }
        
        .measure {
            background: rgba(40, 40, 70, 0.4);
            padding: 8px;
            border-radius: 4px;
            margin: 8px 0;
            letter-spacing: 1px;
        }
        
        .toggle-guide {
            display: inline-block;
            margin-top: 8px;
            padding: 5px 12px;
            background: rgba(80, 80, 120, 0.6);
            border-radius: 4px;
            cursor: pointer;
            font-size: 12px;
            transition: all 0.2s;
        }
        
        .toggle-guide:hover {
            background: rgba(100, 100, 180, 0.7);
        }
        
        .full-guide {
            margin-top: 12px;
            text-align: left;
            background: rgba(30, 30, 50, 0.6);
            padding: 10px 15px;
            border-radius: 6px;
            line-height: 1.8;
        }
        
        .full-guide p {
            margin: 5px 0;
        }

        /* æ·»åŠ ã€Šç¾äººé±¼ã€‹å‰å¥ä¸“ç”¨æ ·å¼?*/
        .right-hand {
            color: #9aff9a;
            background: rgba(0, 150, 50, 0.2);
            padding: 2px 5px;
            border-radius: 3px;
            font-weight: bold;
        }
        
        .left-hand {
            color: #ff9a9a;
            background: rgba(150, 50, 0, 0.2);
            padding: 2px 5px;
            border-radius: 3px;
            font-weight: bold;
        }
        
        .chord-note {
            color: #e2c0ff;
            background: rgba(100, 0, 150, 0.2);
            padding: 2px 4px;
            border-radius: 3px;
            font-weight: bold;
            margin: 0 2px;
        }
        
        .accent-note {
            color: #ffff88;
            font-weight: bold;
            padding: 2px 4px;
            border-radius: 3px;
            background: rgba(150, 150, 0, 0.3);
            margin: 0 2px;
            position: relative;
        }

        .measure-container {
            margin: 12px 0;
            border-left: 2px solid rgba(100, 150, 200, 0.4);
            background: rgba(30, 40, 70, 0.4);
            border-radius: 4px;
        }
        
        .measure-number {
            font-size: 12px;
            color: #aabbdd;
            padding: 3px 8px;
            background: rgba(50, 70, 100, 0.5);
            border-radius: 3px 3px 0 0;
            margin: 0;
        }
        
        .right-part {
            background: rgba(40, 60, 40, 0.3);
            margin: 0 0 1px 0;
            padding: 8px;
        }
        
        .left-part {
            background: rgba(60, 40, 40, 0.3);
            margin: 0;
            padding: 8px;
            border-radius: 0 0 4px 4px;
        }
        
        .finger-position {
            margin-top: 15px;
            background: rgba(60, 50, 80, 0.4);
            padding: 10px;
            border-radius: 4px;
            text-align: left;
            font-size: 13px;
            line-height: 1.8;
        }

        .full-guide p {
            margin: 5px 0;
        }

        /* æ·»åŠ ã€Šç¾äººé±¼ã€‹å‰å¥ä¸“ç”¨æ ·å¼?*/
    </style>
</head>
<body>
    <!-- èƒŒæ™¯å±?-->
    <div class="bg-image" id="bgImage"></div>
    <div class="horizon-glow"></div>
    <div class="stars-layer" id="starsLayer"></div>
    <div class="special-ribbons" id="specialRibbons"></div>
    
    <div class="piano-container">
        <div class="piano" id="piano"></div>
        <div class="pedal" id="pedal">å»¶éŸ³è¸æ¿(ç©ºæ ¼é”?</div>
        <div class="piano-info">
            ä½¿ç”¨é”®ç›˜æˆ–é¼ æ ‡æ¼”å¥?| ç©ºæ ¼é”®æ§åˆ¶å»¶éŸ³è¸æ?        </div>
    </div>
    
    <script src="piano.js"></script>
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // åˆ›å»ºè§†å·®æ•ˆæœ
            document.addEventListener('mousemove', function(e) {
                const bgImage = document.getElementById('bgImage');
                const starsLayer = document.getElementById('starsLayer');
                
                // è®¡ç®—é¼ æ ‡åœ¨å±å¹•ä¸Šçš„ä½ç½®ï¼ˆ0-1èŒƒå›´ï¼?                const mouseX = e.clientX / window.innerWidth;
                const mouseY = e.clientY / window.innerHeight;
                
                // åº”ç”¨è§†å·®æ•ˆæœ
                bgImage.style.transform = `translate(${-mouseX * 20}px, ${-mouseY * 20}px)`;
                starsLayer.style.transform = `translate(${-mouseX * 40}px, ${-mouseY * 40}px)`;
            });
            
            // åˆ›å»ºæ˜Ÿæ˜Ÿ
            createStars();
            
            // åˆ›å»ºè“ç²‰è‰²å…‰å¸?(æ¨¡æ‹Ÿã€Šä½ çš„åå­—ã€‹ä¸­çš„å…‰å¸?
            createSpecialRibbons();
            
            // åˆ›å»ºæµæ˜Ÿæ•ˆæœ - è®¾ç½®é›ªç²’æ¶ˆå¤±æ›´å¿«çš„å…¨å±€å˜é‡
            window.snowflakeSettings = {
                fadeStartThreshold: 0.7,  // ä»?.9æˆ?.8æ”¹ä¸º0.7ï¼Œæ›´æ—©å¼€å§‹æ¶ˆå¤?                fadeMultiplier: 3.5,      // ä»?æˆ?0æ”¹ä¸º3.5ï¼Œæ¶ˆå¤±æ›´å¿?                speedMultiplier: 1.5      // åŠ å¿«æ•´ä½“é›ªç²’é€Ÿåº¦
            };
            createAdvancedComets();
        });
        
        // åˆ›å»ºæ˜Ÿæ˜Ÿ
        function createStars() {
            const starsLayer = document.getElementById('starsLayer');
            const starsCount = 150;
            
            for (let i = 0; i < starsCount; i++) {
                const star = document.createElement('div');
                star.className = 'star';
                
                // æ˜Ÿæ˜Ÿä½ç½®
                const x = Math.random() * 100;
                const y = Math.random() * 100;
                
                // æ˜Ÿæ˜Ÿå¤§å° (1-3px)
                const size = Math.random() * 2 + 1;
                
                // é—ªçƒåŠ¨ç”»
                const duration = Math.random() * 5 + 2;
                const delay = Math.random() * 5;
                const opacity = Math.random() * 0.5 + 0.3;
                
                // å‘å…‰æ•ˆæœ
                const glowSize = Math.random() * 3 + 1;
                
                // åŸºäºä½ç½®é€‰æ‹©é¢œè‰² (åº•éƒ¨åé»„ï¼Œé¡¶éƒ¨åè“?
                let hue;
                if (y > 70) {
                    hue = 40 + Math.random() * 20; // åº•éƒ¨åé»„è‰?                } else if (y < 30) {
                    hue = 180 + Math.random() * 40; // é¡¶éƒ¨åè“è‰?                } else {
                    hue = 200 + Math.random() * 60; // ä¸­é—´åŒºåŸŸ
                }
                
                const glowColor = `hsla(${hue}, 100%, 80%, 0.8)`;
                
                star.style.left = `${x}%`;
                star.style.top = `${y}%`;
                star.style.width = `${size}px`;
                star.style.height = `${size}px`;
                star.style.setProperty('--duration', `${duration}s`);
                star.style.animationDelay = `${delay}s`;
                star.style.setProperty('--opacity', opacity);
                star.style.setProperty('--glow-size', `${glowSize}px`);
                star.style.setProperty('--glow-color', glowColor);
                
                starsLayer.appendChild(star);
            }
        }
        
        // åˆ›å»ºè“ç²‰è‰²å…‰å¸?        function createSpecialRibbons() {
            const ribbonsContainer = document.getElementById('specialRibbons');
            const ribbonsCount = 2; // è“è‰²å’Œç²‰è‰?            
            const colors = ['rgba(0, 162, 255, 0.8)', 'rgba(255, 41, 117, 0.8)'];
            const baseAngles = [-30, -35]; // åŸºç¡€è§’åº¦
            
            for (let i = 0; i < ribbonsCount; i++) {
                const ribbon = document.createElement('div');
                ribbon.className = 'light-ribbon';
                
                const width = window.innerWidth * 1.5;
                const height = 2 + Math.random() * 2;
                
                // èµ·å§‹ä½ç½®ï¼ˆä½äºå±å¹•ä¸ŠåŠéƒ¨åˆ†ï¼‰
                const startX = window.innerWidth * 0.1;
                const startY = window.innerHeight * 0.2;
                
                // æ¯ä¸ªå…‰å¸¦ç•¥æœ‰ä¸åŒçš„è§’åº¦å’Œé•¿åº¦
                const angle = baseAngles[i] + Math.random() * 5;
                
                // ä¸ºæ¯ä¸ªå…‰å¸¦è®¾ç½®é¢œè‰?                const ribbonColor = colors[i];
                
                // åº”ç”¨æ ·å¼
                ribbon.style.width = `${width}px`;
                ribbon.style.height = `${height}px`;
                ribbon.style.left = `${startX}px`;
                ribbon.style.top = `${startY}px`;
                ribbon.style.setProperty('--ribbon-color', ribbonColor);
                ribbon.style.setProperty('--angle', `${angle}deg`);
                ribbon.style.setProperty('--shift', `${Math.random() * 50 - 25}px`);
                ribbon.style.transformOrigin = 'left center';
                ribbon.style.transform = `rotate(${angle}deg)`;
                ribbon.style.animationDelay = `${i * 2}s`;
                
                ribbonsContainer.appendChild(ribbon);
            }
        }
        
        // åˆ›å»ºé›ªç²’æ•ˆæœ - æ›¿ä»£åŸæœ‰çš„æµæ˜Ÿæ•ˆæ?        function createAdvancedComets() {
            const starsLayer = document.getElementById('starsLayer');
            
            // åˆ›å»ºé›ªç²’å®¹å™¨
            const snowflakeContainer = document.createElement('div');
            snowflakeContainer.className = 'snowflake-container';
            starsLayer.appendChild(snowflakeContainer);
            
            // é›ªç²’ç±»å‹
            const snowflakeTypes = [
                'tiny',      // å°å‹é›ªç²’
                'normal',    // æ™®é€šé›ªç²?                'large',     // å¤§å‹é›ªç²’
                'sparkle'    // é—ªå…‰é›ªç²’
            ];
            
            // è·Ÿè¸ªé›ªç²’æ•°é‡
            let activeSnowflakeCount = 0;
            const maxSnowflakes = 500; // ä»?00å¢åŠ åˆ?00ï¼Œæ‰©å¤§é›ªç²’å®¹é‡?            
            // è·å–å…¨å±€é›ªç²’è®¾ç½®
            let settings = window.snowflakeSettings || {
                fadeStartThreshold: 0.9,
                fadeMultiplier: 10,
                speedMultiplier: 1.0
            };
            
            // æ·»åŠ ä¸€ä¸ªå˜é‡æ¥è·Ÿè¸ªæœ€è¿‘æ¸…ç†æ—¶é—?            let lastCleanupTime = 0;
            const cleanupInterval = 5000; // æ¯?ç§’å°è¯•æ¸…ç†ä¸€æ¬?            
            // æ·»åŠ ç›‘æ§è®¡æ•°å™¨å‡½æ•?            function logSnowflakeCount() {
                console.log(`å½“å‰é›ªç²’æ•°é‡: ${activeSnowflakeCount}/${maxSnowflakes}`);
                
                // æ£€æŸ¥DOMä¸­å®é™…çš„é›ªç²’æ•°é‡æ˜¯å¦ä¸è®¡æ•°å™¨åŒ¹é…
                const actualCount = document.querySelectorAll('.snowflake').length;
                if (actualCount !== activeSnowflakeCount) {
                    console.warn(`é›ªç²’è®¡æ•°ä¸åŒ¹é…ï¼è®¡æ•°å™? ${activeSnowflakeCount}, å®é™…DOM: ${actualCount}`);
                    // ä¿®æ­£è®¡æ•°å™?                    activeSnowflakeCount = actualCount;
                }
                
                setTimeout(logSnowflakeCount, 5000); // æ¯?ç§’è®°å½•ä¸€æ¬?            }
            setTimeout(logSnowflakeCount, 5000); // å¼€å§‹ç›‘æ?            
            // èŠ‚å¥æ§åˆ¶ç³»ç»Ÿ - å…¨å±€å˜é‡
            let globalSpeedFactor = 1.0; // åŸºç¡€é€Ÿåº¦å› å­
            let targetSpeedFactor = 1.0; // ç›®æ ‡é€Ÿåº¦å› å­ï¼Œç”¨äºå¹³æ»‘è¿‡æ¸?            let lastNoteTime = 0; // ä¸Šä¸€ä¸ªéŸ³ç¬¦çš„æ—¶é—´æˆ?            let noteIntervals = []; // å­˜å‚¨éŸ³ç¬¦é—´éš”
            const maxIntervals = 10; // åªä¿ç•™æœ€è¿‘çš„10ä¸ªé—´éš?            let isRhythmFast = false; // è®°å½•å½“å‰èŠ‚å¥çŠ¶æ€?            let speedTransitionActive = false; // æ˜¯å¦æ­£åœ¨å¹³æ»‘è¿‡æ¸¡é€Ÿåº¦

            // é€Ÿåº¦å¹³æ»‘è¿‡æ¸¡ç³»ç»Ÿ - å¢å¼ºç‰?            function smoothSpeedTransition() {
                if (!speedTransitionActive) return;
                
                // è®¡ç®—é€Ÿåº¦å·®å¼‚
                const speedDiff = targetSpeedFactor - globalSpeedFactor;
                
                // å¦‚æœå·²ç»éå¸¸æ¥è¿‘ç›®æ ‡é€Ÿåº¦ï¼Œç›´æ¥è®¾ç½®ä¸ºç›®æ ‡é€Ÿåº¦å¹¶åœæ­¢è¿‡æ¸?                if (Math.abs(speedDiff) < 0.03) {
                    globalSpeedFactor = targetSpeedFactor;
                    speedTransitionActive = false;
                    return;
                }
                
                // ä¼˜åŒ–å¹³æ»‘è¿‡æ¸¡ï¼Œä½¿ç”¨ç¼“åŠ¨å‡½æ•?                // å°é€Ÿåº¦å·®å¼‚æ—¶å˜åŒ–æ›´æ…¢ï¼Œå¤§é€Ÿåº¦å·®å¼‚æ—¶å˜åŒ–æ›´å¿?                let adjustFactor;
                if (speedDiff > 0) {
                    // åŠ é€Ÿæ—¶ä½¿ç”¨ç¼“å…¥ç¼“å‡ºæ•ˆæœ - å¼€å§‹å’Œç»“æŸæ…¢ï¼Œä¸­é—´å¿?                    const normalizedDiff = Math.min(speedDiff, 1.0);
                    adjustFactor = 0.12 + (normalizedDiff * 0.08); // 0.12-0.20ä¹‹é—´å˜åŒ–
                } else {
                    // å‡é€Ÿæ—¶æ›´åŠ å¹³æ»‘ï¼Œé¿å…çªç„¶å‡é€?                    const normalizedDiff = Math.min(Math.abs(speedDiff), 1.0);
                    adjustFactor = 0.06 + (normalizedDiff * 0.04); // 0.06-0.10ä¹‹é—´å˜åŒ–
                }
                
                // åº”ç”¨é€Ÿåº¦è°ƒæ•´
                globalSpeedFactor += speedDiff * adjustFactor;
                
                // ç»§ç»­ä¸‹ä¸€å¸§çš„è¿‡æ¸¡
                requestAnimationFrame(smoothSpeedTransition);
            }
            
            // è®¾ç½®ç›®æ ‡é€Ÿåº¦å¹¶å¯åŠ¨å¹³æ»‘è¿‡æ¸?            function setTargetSpeed(newSpeed) {
                // å¦‚æœç›®æ ‡é€Ÿåº¦ä¸å½“å‰ç›®æ ‡ç›¸åŒï¼Œåˆ™ä¸éœ€è¦æ”¹å?                if (newSpeed === targetSpeedFactor) return;
                
                // è®¾ç½®æ–°çš„ç›®æ ‡é€Ÿåº¦
                targetSpeedFactor = newSpeed;
                
                // å¦‚æœæ²¡æœ‰æ´»è·ƒçš„è¿‡æ¸¡ï¼Œå¯åŠ¨ä¸€ä¸?                if (!speedTransitionActive) {
                    speedTransitionActive = true;
                    requestAnimationFrame(smoothSpeedTransition);
                }
            }
            
            // å¢å¼ºç‰ˆèŠ‚å¥æ£€æµ‹å‡½æ•?            function updateRhythm() {
                const now = performance.now();
                if (lastNoteTime > 0) {
                    const interval = now - lastNoteTime;
                    
                    // åªè®°å½•åˆç†çš„é—´éš”ï¼ˆå¿½ç•¥è¿‡é•¿çš„åœé¡¿ï¼?                    if (interval < 2000) {
                        noteIntervals.push(interval);
                        
                        // ä¿æŒæ•°ç»„å¤§å°
                        if (noteIntervals.length > maxIntervals) {
                            noteIntervals.shift();
                        }
                        
                        // è®¡ç®—å¹³å‡é—´éš”æ—¶é—´
                        if (noteIntervals.length >= 3) { // è‡³å°‘éœ€è¦å‡ ä¸ªæ•°æ®ç‚¹æ‰èƒ½åˆ¤æ–­èŠ‚å¥
                            const avgInterval = noteIntervals.reduce((sum, val) => sum + val, 0) / noteIntervals.length;
                            
                            // ä½¿ç”¨å¹³æ»‘çš„é€Ÿåº¦æ˜ å°„å‡½æ•°è€Œä¸æ˜¯ç¦»æ•£çš„é˜ˆå€?                            // è¿™ä¼šæ ¹æ®æ¼”å¥é€Ÿåº¦æä¾›æ›´è¿ç»­çš„é€Ÿåº¦å˜åŒ–
                            let newTargetSpeed;
                            
                            if (avgInterval <= 200) {
                                // éå¸¸å¿«çš„èŠ‚å¥å›ºå®šä¸ºæœ€é«˜é€Ÿåº¦
                                newTargetSpeed = 2.5;
                            } else if (avgInterval >= 800) {
                                // éå¸¸æ…¢çš„èŠ‚å¥å›ºå®šä¸ºåŸºç¡€é€Ÿåº¦
                                newTargetSpeed = 1.0;
                            } else {
                                // ä½¿ç”¨å¹³æ»‘çš„æ˜ å°„å‡½æ•°è®¡ç®—ä¸­é—´é€Ÿåº¦
                                // ä»?800,1.0)åˆ?200,2.5)çš„çº¿æ€§æ˜ å°?                                const normalizedInterval = (800 - avgInterval) / 600; // 0åˆ?çš„èŒƒå›?                                newTargetSpeed = 1.0 + (normalizedInterval * 1.5); // 1.0åˆ?.5çš„èŒƒå›?                            }
                            
                            // æ›´æ–°èŠ‚å¥çŠ¶æ€?                            isRhythmFast = newTargetSpeed > 1.3;
                            
                            // ä½¿ç”¨å¹³æ»‘è¿‡æ¸¡è®¾ç½®æ–°çš„ç›®æ ‡é€Ÿåº¦
                            setTargetSpeed(newTargetSpeed);
                            
                            // æ ¹æ®èŠ‚å¥é€Ÿåº¦åˆ›å»ºé›ªç²’
                            // èŠ‚å¥è¶Šå¿«ï¼Œåˆ›å»ºçš„é›ªç²’è¶Šå¤š
                            if (isRhythmFast) {
                                // è®¡ç®—å¼ºåº¦ï¼Œç”¨äºå†³å®šåˆ›å»ºé›ªç²’çš„æ•°é‡
                                const intensity = Math.min(1.0, (newTargetSpeed - 1.0) / 1.5); // 0åˆ?çš„èŒƒå›?                                createRhythmSnowfall(intensity);
                            } else {
                                // å³ä½¿åœ¨æ…¢èŠ‚å¥ä¸‹ä¹Ÿåˆ›å»ºå°‘é‡é›ªç²’
                                const lowIntensity = 0.2 + (newTargetSpeed - 1.0) * 0.2; // ä½å¼ºåº¦ï¼Œä½†ä»ç„¶ä¼šåˆ›å»ºä¸€äº›é›ªç²?                                createRhythmSnowfall(lowIntensity);
                            }
                        }
                    }
                }
                lastNoteTime = now;
            }
            
            // åŸºäºèŠ‚å¥åˆ›å»ºæ–°çš„é›ªç²’ç¾?- å¢å¼ºç‰?            function createRhythmSnowfall(intensity = 0.6) {
                // åŸºäºå¼ºåº¦è®¡ç®—é›ªç²’æ•°é‡ï¼Œæ›´å¿«çš„èŠ‚å¥ä¼šäº§ç”Ÿæ›´å¤šé›ªç²?                // å¢åŠ åŸºç¡€æ•°é‡ï¼Œç¡®ä¿å³ä½¿åœ¨ä½å¼ºåº¦ä¸‹ä¹Ÿæœ‰è¶³å¤Ÿçš„é›ªç²?                const baseCount = 4;
                const variableCount = Math.floor(10 * intensity); // 0-10ä¹‹é—´å˜åŒ–ï¼Œå¢åŠ äº†æœ€å¤§æ•°é‡?                const count = baseCount + variableCount;
                
                // ä»å±å¹•é¡¶éƒ¨éšæœºä½ç½®åˆ›å»ºé›ªç²?                for (let i = 0; i < count; i++) {
                    setTimeout(() => {
                        if (activeSnowflakeCount < maxSnowflakes) {
                            // åˆ›å»ºå±å¹•é¡¶éƒ¨çš„é›ªç²?                            createTopSnowflake(intensity);
                        }
                    }, i * 30 + Math.random() * 20); // æ›´ç´§å‡‘çš„æ—¶é—´é—´éš”ï¼Œä½¿é›ªç²’è½ä¸‹æ›´è¿ç»?                }
            }
            
            // æ–°å¢å‡½æ•°ï¼šç®¡ç†é›ªç²’æ•°é‡ï¼Œä¸»åŠ¨æ¸…ç†ä¸å¯è§çš„é›ªç²’
            function manageSnowflakes() {
                const now = performance.now();
                
                // ä¸è¦å¤ªé¢‘ç¹æ¸…ç?                if (now - lastCleanupTime < cleanupInterval) return;
                
                lastCleanupTime = now;
                
                // åªæœ‰å½“é›ªç²’æ•°é‡æ¥è¿‘ä¸Šé™æ—¶æ‰å°è¯•æ¸…ç?                if (activeSnowflakeCount > maxSnowflakes * 0.8) {
                    console.log(`æ¸…ç†å‰é›ªç²’æ•°é‡? ${activeSnowflakeCount}`);
                    
                    // æŸ¥æ‰¾æ‰€æœ‰é›ªç²?                    const allSnowflakes = document.querySelectorAll('.snowflake');
                    
                    // è·å–è§†å£é«˜åº¦
                    const viewportHeight = window.innerHeight;
                    
                    // æ¸…ç†å·²ç»è¶…å‡ºè§†å£çš„é›ªç²?                    let cleanedCount = 0;
                    allSnowflakes.forEach(snowflake => {
                        const rect = snowflake.getBoundingClientRect();
                        
                        // å¦‚æœé›ªç²’å·²ç»è¶…å‡ºè§†å£åº•éƒ¨æˆ–ä¸å¯è§ï¼ˆå¯èƒ½å¡åœ¨æŸå¤„ï¼‰
                        if (rect.top > viewportHeight + 50 || parseFloat(snowflake.style.opacity || '1') < 0.1) {
                            snowflake.remove();
                            cleanedCount++;
                        }
                    });
                    
                    // æ›´æ–°è®¡æ•°
                    activeSnowflakeCount = document.querySelectorAll('.snowflake').length;
                    
                    console.log(`æ¸…ç†äº?${cleanedCount} ä¸ªé›ªç²’ï¼Œå½“å‰æ•°é‡: ${activeSnowflakeCount}`);
                }
            }
            
            // åˆ›å»ºæ–°é›ªç²’ä¹‹å‰ï¼Œç¡®ä¿è®¡æ•°å‡†ç¡®
            function ensureAccurateCount() {
                const actualCount = document.querySelectorAll('.snowflake').length;
                if (Math.abs(actualCount - activeSnowflakeCount) > 10) {
                    console.warn(`é›ªç²’è®¡æ•°å·®å¼‚è¿‡å¤§ï¼Œé‡ç½®è®¡æ•°å™¨ã€‚è®¡æ•°å™¨: ${activeSnowflakeCount}, å®é™…DOM: ${actualCount}`);
                    activeSnowflakeCount = actualCount;
                }
                return activeSnowflakeCount;
            }
            
            // æ–°å¢å‡½æ•°ï¼šä»å±å¹•é¡¶éƒ¨åˆ›å»ºé›ªç²’
            function createTopSnowflake(intensity = 0.5, isBlackKey = false) {
                // ç¡®ä¿è®¡æ•°å‡†ç¡®
                ensureAccurateCount();
                
                if (activeSnowflakeCount >= maxSnowflakes) {
                    // å³ä½¿è¾¾åˆ°æœ€å¤§æ•°é‡ï¼Œä¹Ÿå°è¯•æ¸…ç†ä¸€ä¸‹ï¼Œä¸ºæ–°é›ªç²’è…¾å‡ºç©ºé—´
                    manageSnowflakes();
                    // å¦‚æœä»ç„¶è¾¾åˆ°æœ€å¤§æ•°é‡ï¼Œè¿”å›
                    if (activeSnowflakeCount >= maxSnowflakes) return;
                }
                
                activeSnowflakeCount++;
                
                const snowflake = document.createElement('div');
                
                // æ ¹æ®å¼ºåº¦å’ŒæŒ‰é”®ç±»å‹é€‰æ‹©é›ªç²’ç±»å‹
                let typeIndex;
                let sparkleChance;
                
                if (isBlackKey) {
                    // é»‘é”®çš„é›ªç²’æ›´åå‘äºå†·è‰²è°ƒ/è“è‰²çš„é—ªå…‰é›ªç²?                    sparkleChance = 0.2 + (intensity * 0.6); // é»‘é”®æœ‰æ›´é«˜å‡ ç‡äº§ç”Ÿé—ªå…‰é›ªç²?20%-80%)
                } else {
                    // ç™½é”®çš„é›ªç²’æ›´åå‘äºæ™®é€šé›ªç²?                    sparkleChance = 0.1 + (intensity * 0.5); // 10%-60%å‡ ç‡æ˜¯é—ªå…‰é›ªç²?                }
                
                if (Math.random() < sparkleChance) {
                    typeIndex = 3; // é—ªå…‰é›ªç²’
                } else {
                    // å…¶ä½™å‡ ç‡åœ¨å…¶ä»–ç±»å‹ä¸­åˆ†é…ï¼Œå¼ºåº¦é«˜æ—¶åå‘å¤§é›ªç²’
                    const largeChance = 0.2 + (intensity * 0.4); // 20%-60%å‡ ç‡æ˜¯å¤§é›ªç²’
                    if (Math.random() < largeChance) {
                        typeIndex = 2; // å¤§é›ªç²?                    } else {
                        typeIndex = Math.random() < 0.6 ? 1 : 0; // æ™®é€šæˆ–å°é›ªç²?                    }
                }
                
                const snowflakeType = snowflakeTypes[typeIndex];
                snowflake.className = `snowflake ${snowflakeType}`;
                
                // ä»å±å¹•é¡¶éƒ¨éšæœºä½ç½®ç”Ÿæˆ?                // ç¡®ä¿é›ªç²’åˆ†å¸ƒåœ¨æ•´ä¸ªå±å¹•å®½åº¦ä¸Š
                const startX = Math.random() * window.innerWidth;
                const startY = -5 - Math.random() * 15; // ä»å±å¹•é¡¶éƒ¨ç¨å¾®ä¸Šæ–¹å¼€å§?                
                snowflake.style.left = `${startX}px`;
                snowflake.style.top = `${startY}px`;
                
                // æ ¹æ®æŒ‰é”®ç±»å‹è®¾ç½®ä¸åŒçš„é¢œè‰?                if (isBlackKey) {
                    // é»‘é”®çš„é›ªç²’åå‘äºè“ç´«è‰?                    if (snowflakeType === 'sparkle') {
                        // é—ªå…‰é›ªç²’ä½¿ç”¨æ›´æ˜äº®çš„è“ç´«è‰?                        const hue = 230 + Math.random() * 40; // 230-270(è“ç´«è‰²èŒƒå›?
                        const saturation = 80 + Math.random() * 20; // 80%-100%
                        const lightness = 70 + Math.random() * 20; // 70%-90%
                        const brightness = 1.2 + (intensity * 0.4);
                        
                        snowflake.style.backgroundColor = `hsl(${hue}, ${saturation}%, ${lightness}%)`;
                        snowflake.style.boxShadow = `0 0 4px hsl(${hue}, ${saturation}%, ${lightness}%)`;
                        snowflake.style.filter = `blur(0.5px) brightness(${brightness})`;
                    } else {
                        // å…¶ä»–ç±»å‹çš„é›ªç²’ä½¿ç”¨æ·¡è“è‰²
                        const hue = 210 + Math.random() * 30; // 210-240(æ·¡è“è‰²èŒƒå›?
                        const saturation = 70 + Math.random() * 20; // 70%-90%
                        const lightness = 75 + Math.random() * 15; // 75%-90%
                        
                        snowflake.style.backgroundColor = `hsl(${hue}, ${saturation}%, ${lightness}%)`;
                        snowflake.style.boxShadow = `0 0 3px hsl(${hue}, ${saturation}%, ${lightness}%)`;
                    }
                } else {
                    // ç™½é”®çš„é›ªç²’ä¿æŒåŸæœ‰çš„ç™½è‰²æˆ–æ·¡é‡‘è‰²
                    if (snowflakeType === 'sparkle') {
                        const brightness = 1.1 + (intensity * 0.4);
                        // ä½¿ç”¨æ·¡é‡‘è‰?                        const hue = 40 + Math.random() * 20; // 40-60(æ·¡é‡‘è‰²èŒƒå›?
                        const saturation = 80 + Math.random() * 20; // 80%-100%
                        const lightness = 75 + Math.random() * 15; // 75%-90%
                        
                        snowflake.style.backgroundColor = `hsl(${hue}, ${saturation}%, ${lightness}%)`;
                        snowflake.style.boxShadow = `0 0 4px hsl(${hue}, ${saturation}%, ${lightness}%)`;
                        snowflake.style.filter = `blur(0.5px) brightness(${brightness})`;
                    }
                }
                
                snowflakeContainer.appendChild(snowflake);
                
                // è·å–é›ªç²’çš„åŸºç¡€é€Ÿåº¦èŒƒå›´
                let baseMinSpeed, baseMaxSpeed;
                
                // æ ¹æ®é›ªç²’ç±»å‹ã€å¼ºåº¦å’ŒæŒ‰é”®ç±»å‹è®¾ç½®é€Ÿåº¦èŒƒå›´
                // é»‘é”®çš„é›ªç²’å¯ä»¥ç¨å¿«ä¸€äº?                const keySpeedMultiplier = isBlackKey ? 1.15 : 1.0;
                
                switch (snowflakeType) {
                    case 'tiny': 
                        baseMinSpeed = (0.4 + (intensity * 0.2)) * keySpeedMultiplier; 
                        baseMaxSpeed = (0.8 + (intensity * 0.4)) * keySpeedMultiplier; 
                        break;
                    case 'normal': 
                        baseMinSpeed = (0.6 + (intensity * 0.3)) * keySpeedMultiplier; 
                        baseMaxSpeed = (1.2 + (intensity * 0.6)) * keySpeedMultiplier; 
                        break;
                    case 'large': 
                        baseMinSpeed = (0.8 + (intensity * 0.4)) * keySpeedMultiplier; 
                        baseMaxSpeed = (1.5 + (intensity * 0.7)) * keySpeedMultiplier; 
                        break;
                    case 'sparkle': 
                        baseMinSpeed = (1.0 + (intensity * 0.5)) * keySpeedMultiplier; 
                        baseMaxSpeed = (1.8 + (intensity * 0.8)) * keySpeedMultiplier; 
                        break;
                    default: 
                        baseMinSpeed = (0.7 + (intensity * 0.3)) * keySpeedMultiplier; 
                        baseMaxSpeed = (1.4 + (intensity * 0.6)) * keySpeedMultiplier;
                }
                
                // åœ¨èŒƒå›´å†…éšæœºé€‰æ‹©åŸºç¡€é€Ÿåº¦
                const baseSpeed = baseMinSpeed + Math.random() * (baseMaxSpeed - baseMinSpeed);
                
                // åº”ç”¨å½“å‰å…¨å±€é€Ÿåº¦å› å­
                const initialSpeed = baseSpeed * globalSpeedFactor;
                
                // ä¿å­˜ä¸ºå›ºå®šé€Ÿåº¦ï¼Œä¸éšåç»­å…¨å±€é€Ÿåº¦å˜åŒ–
                snowflake.dataset.speed = initialSpeed.toString();
                snowflake.dataset.fixed = "true";
                
                // è®¡ç®—è·ç¦»å’ŒåŸºæœ¬å‚æ•?                const distance = window.innerHeight + 50 - startY;
                
                // æ°´å¹³æ¼‚ç§»å‚æ•° - æ‘†åŠ¨å¹…åº¦ä¸å¼ºåº¦ç›¸å…?                // é»‘é”®çš„é›ªç²’æ¼‚ç§»å¹…åº¦ç¨å°ï¼Œæ›´å‚ç›´ä¸‹è?                const driftMultiplier = isBlackKey ? 0.8 : 1.0;
                const horizontalDrift = (20 + Math.random() * 40 + (intensity * 20)) * driftMultiplier;
                const driftDirection = Math.random() > 0.5 ? 1 : -1;
                // é»‘é”®çš„é›ªç²’æ‘†åŠ¨é¢‘ç‡æ›´é«˜ï¼Œå‘ˆç°ä¸åŒçš„è§†è§‰æ•ˆæ?                const swayFrequency = isBlackKey ? 
                    (0.7 + Math.random() * 1.2) : // é»‘é”®: 0.7-1.9
                    (0.5 + Math.random() * 1.0);  // ç™½é”®: 0.5-1.5
                
                const startTime = performance.now();
                
                // é›ªç²’åŠ¨ç”»å‡½æ•°
                function animateTopSnowflake(timestamp) {
                    const elapsed = timestamp - startTime;
                    
                    // ä½¿ç”¨å›ºå®šåˆå§‹é€Ÿåº¦ * å…¨å±€é€Ÿåº¦å€å¢å™?                    const currentSpeed = parseFloat(snowflake.dataset.speed) * settings.speedMultiplier;
                    
                    // è®¡ç®—æŒç»­æ—¶é—´å’Œè¿›åº?                    const adjustedDuration = distance / (currentSpeed * 50);
                    const progress = Math.min(elapsed / (adjustedDuration * 1000), 1);
                    
                    if (progress <= 1) {
                        // å‚ç›´æ–¹å‘æ˜¯çº¿æ€§ä¸‹è?                        const y = startY + distance * progress;
                        
                        // æ°´å¹³æ–¹å‘æ˜¯æ­£å¼¦æ‘†åŠ?                        const x = startX + Math.sin(progress * Math.PI * swayFrequency * 2) * horizontalDrift * driftDirection;
                        
                        // æ›´æ–°ä½ç½®
                        snowflake.style.left = `${x}px`;
                        snowflake.style.top = `${y}px`;
                        
                        // éšç€ä¸‹è½è½»å¾®æ—‹è½¬ - é»‘é”®å’Œç™½é”®æ—‹è½¬æ–¹å¼ä¸å?                        const rotationAngle = isBlackKey ? 
                            (progress * 450 * (Math.random() > 0.5 ? 1 : -1)) : // é»‘é”®æ—‹è½¬æ›´å¿«
                            (progress * 360 * (Math.random() > 0.5 ? 1 : -1));  // ç™½é”®æ­£å¸¸æ—‹è½¬
                        
                        snowflake.style.transform = `rotate(${rotationAngle}deg)`;
                        
                        // æ¥è¿‘åœ°é¢æ—¶æ¸æ¸æ¶ˆå¤?- ä½¿ç”¨å…¨å±€è®¾ç½®
                        if (progress > settings.fadeStartThreshold) {
                            snowflake.style.opacity = `${(1 - progress) * settings.fadeMultiplier}`;
                        }
                        
                        requestAnimationFrame(animateTopSnowflake);
                    } else {
                        // åŠ¨ç”»ç»“æŸï¼Œç§»é™¤é›ªç²?                        snowflake.remove();
                        activeSnowflakeCount = Math.max(0, activeSnowflakeCount - 1); // ç¡®ä¿ä¸ä¼šå°äº0
                        
                        // æœ‰ä¸€å®šæ¦‚ç‡åˆ›å»ºæ–°é›ªç²’ï¼Œä¿æŒé›ªç²’æ•°é‡?                        if (Math.random() < 0.3 && activeSnowflakeCount < maxSnowflakes * 0.8) {
                            setTimeout(() => {
                                createTopSnowflake(intensity * 0.8, isBlackKey); // é™ä½å¼ºåº¦ï¼Œé€æ¸æ¢å¤æ­£å¸¸
                            }, Math.random() * 200);
                        }
                    }
                }
                
                // å¼€å§‹åŠ¨ç”?                requestAnimationFrame(animateTopSnowflake);
            }
            
            // ä¿®æ”¹createSnowflakeå‡½æ•°å¼€å¤´éƒ¨åˆ?            function createSnowflake(isTriggered = false, isRhythmBased = false, intensity = 0.5, isBlackKey = false) {
                // ç¡®ä¿è®¡æ•°å‡†ç¡®
                ensureAccurateCount();
                
                // æ§åˆ¶é›ªç²’æ•°é‡
                if (activeSnowflakeCount >= maxSnowflakes) {
                    // å°è¯•æ¸…ç†ä¸å¯è§çš„é›ªç²’
                    manageSnowflakes();
                    
                    if (isTriggered) {
                        // å¦‚æœæ˜¯æŒ‰é”®è§¦å‘çš„ï¼Œå³ä½¿è¾¾åˆ°æœ€å¤§æ•°é‡ä¹Ÿè¦å°è¯•åˆ›å»ºçˆ†å‘æ•ˆæ?                        // ä½†å¼ºåˆ¶ä¿ç•™ä¸€äº›å®¹é‡ç»™è§¦å‘çš„é›ªç²?                        if (activeSnowflakeCount > maxSnowflakes * 0.95) {
                            // å¦‚æœå®åœ¨å¤ªå¤šï¼Œåªåˆ›å»ºæœ€å°‘é‡
                            const burstCount = 2;
                            createMinimalSnowBurst(burstCount, isBlackKey);
                        } else {
                            createTriggeredSnowBurst(isBlackKey);
                        }
                        return;
                    } else if (activeSnowflakeCount >= maxSnowflakes) {
                        // å¦‚æœæ¸…ç†åä»ç„¶è¾¾åˆ°æœ€å¤§æ•°é‡ï¼Œå»¶è¿Ÿå°è¯•
                        setTimeout(() => createSnowflake(false, false, 0.5, isBlackKey), 500);
                        return;
                    }
                }
                
                activeSnowflakeCount++;
                
                const snowflake = document.createElement('div');
                
                // é€‰æ‹©é›ªç²’ç±»å‹
                let typeIndex;
                if (isTriggered) {
                    // æŒ‰é”®è§¦å‘çš„é›ªç²’æ›´å€¾å‘äºä½¿ç”¨å¤§å‹å’Œé—ªå…‰
                    typeIndex = Math.random() > 0.25 ? 3 : 2; // 75%å‡ ç‡æ˜¯é—ªå…‰é›ªç²?                } else if (isRhythmBased) {
                    // èŠ‚å¥è§¦å‘çš„é›ªç²’æ ¹æ®èŠ‚å¥å¼ºåº¦è°ƒæ•´ç±»å?                    // å¼ºåº¦é«˜æ—¶æ›´å¤šé—ªå…‰é›ªç²’
                    const sparkleChance = 0.4 + (intensity * 0.4); // 40%-80%å‡ ç‡æ˜¯é—ªå…‰é›ªç²?                    if (Math.random() < sparkleChance) {
                        typeIndex = 3; // é—ªå…‰é›ªç²’
                    } else {
                        // å…¶ä½™å‡ ç‡åœ¨å…¶ä»–ç±»å‹ä¸­åˆ†é…ï¼Œå¼ºåº¦é«˜æ—¶åå‘å¤§é›ªç²’
                        const largeChance = 0.4 + (intensity * 0.3); // 40%-70%
                        if (Math.random() < largeChance) {
                            typeIndex = 2; // å¤§é›ªç²?                        } else {
                            typeIndex = Math.random() < 0.6 ? 1 : 0; // æ™®é€šæˆ–å°é›ªç²?                        }
                    }
                } else {
                    // è‡ªåŠ¨ç”Ÿæˆçš„é›ªç²?- ä¿æŒå¹³è¡¡åˆ†å¸ƒ
                    const rand = Math.random();
                    if (rand < 0.4) typeIndex = 0; // 40%å‡ ç‡æ˜¯tiny
                    else if (rand < 0.75) typeIndex = 1; // 35%å‡ ç‡æ˜¯normal  
                    else if (rand < 0.95) typeIndex = 2; // 20%å‡ ç‡æ˜¯large
                    else typeIndex = 3; // 5%å‡ ç‡æ˜¯sparkle
                }
                
                const snowflakeType = snowflakeTypes[typeIndex];
                snowflake.className = `snowflake ${snowflakeType}`;
                
                // é›ªç²’èµ·å§‹ä½ç½®
                let startX, startY;
                
                if (isTriggered) {
                    // æŒ‰é”®è§¦å‘çš„é›ªç²’ä»é’¢ç´ä¸Šæ–¹åŒºåŸŸç”Ÿæˆ
                    const pianoEl = document.querySelector('.piano-container');
                    const pianoRect = pianoEl.getBoundingClientRect();
                    startX = pianoRect.left + Math.random() * pianoRect.width;
                    startY = pianoRect.top - 20 - Math.random() * 50;
                } else if (isRhythmBased) {
                    // èŠ‚å¥è§¦å‘çš„é›ªç²’ä»å±å¹•é¡¶éƒ¨å‡åŒ€åˆ†å¸ƒåŒºåŸŸç”Ÿæˆ
                    startX = Math.random() * window.innerWidth;
                    startY = -5 - Math.random() * 15; // ä»å±å¹•é¡¶éƒ¨ç¨å¾®ä¸Šæ–¹å¼€å§?                } else {
                    // è‡ªåŠ¨ç”Ÿæˆçš„é›ªç²’ä»å±å¹•é¡¶éƒ¨æˆ–ç¨å¾®ä¸Šæ–¹ç”Ÿæˆ?                    startX = Math.random() * window.innerWidth;
                    startY = -10 - Math.random() * 30; // ä»å±å¹•é¡¶éƒ¨ä¸Šæ–¹ä¸€ç‚¹å¼€å§?                }
                
                snowflake.style.left = `${startX}px`;
                snowflake.style.top = `${startY}px`;
                
                snowflakeContainer.appendChild(snowflake);
                
                // è·å–é›ªç²’çš„åŸºç¡€é€Ÿåº¦èŒƒå›´ - ä¸ºæ¯ä¸ªé›ªç²’è®¾ç½®éšæœºèŒƒå›´å†…çš„åˆå§‹é€Ÿåº¦
                let baseMinSpeed, baseMaxSpeed;
                
                // æ ¹æ®é›ªç²’ç±»å‹è®¾ç½®ä¸åŒçš„é€Ÿåº¦èŒƒå›´
                switch (snowflakeType) {
                    case 'tiny': 
                        baseMinSpeed = 0.4; 
                        baseMaxSpeed = 0.8; 
                        break;
                    case 'normal': 
                        baseMinSpeed = 0.6; 
                        baseMaxSpeed = 1.2; 
                        break;
                    case 'large': 
                        baseMinSpeed = 0.8; 
                        baseMaxSpeed = 1.5; 
                        break;
                    case 'sparkle': 
                        baseMinSpeed = isTriggered ? 1.2 : 1.0; 
                        baseMaxSpeed = isTriggered ? 2.0 : 1.8; 
                        break;
                    default: 
                        baseMinSpeed = 0.7; 
                        baseMaxSpeed = 1.4;
                }
                
                // åœ¨èŒƒå›´å†…éšæœºé€‰æ‹©åŸºç¡€é€Ÿåº¦ - ç¡®ä¿æ¯ä¸ªé›ªç²’æœ‰ä¸åŒåˆé€Ÿåº¦
                const baseSpeed = baseMinSpeed + Math.random() * (baseMaxSpeed - baseMinSpeed);
                
                // åº”ç”¨é¢å¤–ä¿®æ­£å› å­
                let speedModifier = 1.0;
                
                // æŒ‰é”®è§¦å‘çš„é›ªç²’ç•¥å¿?                if (isTriggered) {
                    speedModifier *= 1.3;
                }
                
                // èŠ‚å¥è§¦å‘çš„é›ªç²’é€Ÿåº¦ä¸èŠ‚å¥å¼ºåº¦ç›¸å…?                if (isRhythmBased) {
                    speedModifier *= 1.0 + (intensity * 0.4); // å¼ºåº¦è¶Šé«˜ï¼Œé€Ÿåº¦è¶Šå¿«
                }
                
                // å½“å‰å¼¹å¥èŠ‚å¥çš„å…¨å±€å› å­ - å½±å“åˆå§‹é€Ÿåº¦
                speedModifier *= globalSpeedFactor;
                
                // æœ€ç»ˆçš„åˆå§‹é€Ÿåº¦ - ä¿å­˜ä¸ºå›ºå®šå€?                const initialSpeed = baseSpeed * speedModifier;
                
                // å­˜å‚¨åˆå§‹é€Ÿåº¦åˆ°å…ƒç´ æ•°æ®å±æ€§ä¸­ - æ‰€æœ‰é›ªç²’éƒ½æ˜¯å›ºå®šåˆå§‹é€Ÿåº¦
                snowflake.dataset.speed = initialSpeed.toString();
                // æ‰€æœ‰é›ªç²’éƒ½æ ‡è®°ä¸ºå›ºå®šé€Ÿåº¦ï¼Œå³åˆ›å»ºåä¸å†å—å…¨å±€èŠ‚å¥å˜åŒ–å½±å“
                snowflake.dataset.fixed = "true";
                
                // è®¡ç®—è·ç¦»å’ŒåŸºæœ¬å‚æ•?                const distance = window.innerHeight + 50 - startY;
                
                // æ°´å¹³æ¼‚ç§»å‚æ•° - æ¨¡æ‹Ÿé›ªçš„é£˜åŠ¨
                const horizontalDrift = isTriggered ? 15 + Math.random() * 20 : 30 + Math.random() * 60;
                const driftDirection = Math.random() > 0.5 ? 1 : -1; // éšæœºå·¦å³æ¼‚ç§»
                const swayFrequency = 0.5 + Math.random() * 1.0; // æ‘†åŠ¨é¢‘ç‡
                
                // åŠ¨ç”»å¼€å§‹æ—¶é—?                const startTime = performance.now();
                
                // é›ªç²’åŠ¨ç”»å‡½æ•° - ä½¿ç”¨å›ºå®šåˆå§‹é€Ÿåº¦ï¼Œä¸å—åç»­å…¨å±€é€Ÿåº¦å˜åŒ–å½±å“
                function animateSnowflake(timestamp) {
                    const elapsed = timestamp - startTime;
                    
                    // ä½¿ç”¨åˆ›å»ºæ—¶å›ºå®šçš„åˆå§‹é€Ÿåº¦ï¼Œä¸éšå…¨å±€é€Ÿåº¦å˜åŒ–ï¼Œä½†åº”ç”¨å…¨å±€é€Ÿåº¦å€å¢å™?                    const currentSpeed = parseFloat(snowflake.dataset.speed) * settings.speedMultiplier;
                    
                    // è®¡ç®—æŒç»­æ—¶é—´å’Œè¿›åº?                    const adjustedDuration = distance / (currentSpeed * 50);
                    const progress = Math.min(elapsed / (adjustedDuration * 1000), 1);
                    
                    if (progress <= 1) {
                        // å‚ç›´æ–¹å‘æ˜¯çº¿æ€§ä¸‹è?                        const y = startY + distance * progress;
                        
                        // æ°´å¹³æ–¹å‘æ˜¯æ­£å¼¦æ‘†åŠ?                        const x = startX + Math.sin(progress * Math.PI * swayFrequency * 2) * horizontalDrift * driftDirection;
                        
                        // æ›´æ–°ä½ç½®
                        snowflake.style.left = `${x}px`;
                        snowflake.style.top = `${y}px`;
                        
                        // éšç€ä¸‹è½è½»å¾®æ—‹è½¬
                        snowflake.style.transform = `rotate(${progress * 360 * (Math.random() > 0.5 ? 1 : -1)}deg)`;
                        
                        // æ¥è¿‘åœ°é¢æ—¶æ¸æ¸æ¶ˆå¤?- ä½¿ç”¨å…¨å±€è®¾ç½®
                        if (progress > settings.fadeStartThreshold) {
                            snowflake.style.opacity = `${(1 - progress) * settings.fadeMultiplier}`;
                        }
                        
                        requestAnimationFrame(animateSnowflake);
                    } else {
                        // åŠ¨ç”»ç»“æŸï¼Œç§»é™¤é›ªç²?                        snowflake.remove();
                        activeSnowflakeCount--;
                        
                        // å¯¹äºéè§¦å‘çš„é›ªç²’ï¼ŒæŒç»­åˆ›å»ºæ–°é›ªç²’
                        if (!isTriggered) {
                            setTimeout(() => {
                                createSnowflake(false);
                            }, Math.random() * 300); // æ›´å¿«åœ°è¡¥å……æ–°é›ªç²’
                        }
                    }
                }
                
                // å¼€å§‹åŠ¨ç”?                requestAnimationFrame(animateSnowflake);
            }
            
            // æŒ‰é”®è§¦å‘çš„é›ªç²’çˆ†å‘æ•ˆæ?            function createTriggeredSnowBurst(isBlackKey = false) {
                // ä¸€æ¬¡äº§ç”Ÿå¤šä¸ªé›ªç²?                const burstCount = 5 + Math.floor(Math.random() * 5);
                const pianoEl = document.querySelector('.piano-container');
                const pianoRect = pianoEl.getBoundingClientRect();
                
                for (let i = 0; i < burstCount; i++) {
                    // ç¡®ä¿ä¸è¶…è¿‡æœ€å¤§æ•°é‡?                    if (activeSnowflakeCount < maxSnowflakes) {
                        const snowflake = document.createElement('div');
                        activeSnowflakeCount++;
                        
                        // ä¼˜å…ˆä½¿ç”¨é—ªå…‰å’Œå¤§å‹é›ªç²’ï¼Œé»‘é”®ç™½é”®æœ‰ä¸åŒçš„æ¦‚ç‡
                        let typeIndex;
                        const sparkleChance = isBlackKey ? 0.75 : 0.7; // é»‘é”®æ›´é«˜æ¦‚ç‡ä½¿ç”¨é—ªå…‰é›ªç²’
                        typeIndex = Math.random() < sparkleChance ? 3 : 2; // é—ªå…‰æˆ–å¤§å‹é›ªç²?                        
                        const snowflakeType = snowflakeTypes[typeIndex];
                        snowflake.className = `snowflake ${snowflakeType}`;
                        
                        // ä»é’¢ç´ä¸Šæ–¹çš„ä¸€ä¸ªåŒºåŸŸç”Ÿæˆ?                        const burstCenterX = pianoRect.left + (pianoRect.width * 0.5);
                        const startX = burstCenterX - 100 + Math.random() * 200;
                        const startY = pianoRect.top - 30 - Math.random() * 20;
                        
                        snowflake.style.left = `${startX}px`;
                        snowflake.style.top = `${startY}px`;
                        
                        // æ ¹æ®æŒ‰é”®ç±»å‹è®¾ç½®ä¸åŒé¢œè‰²
                        if (isBlackKey) {
                            // é»‘é”®çˆ†å‘ä½¿ç”¨è“ç´«è‰²ç³»
                            if (snowflakeType === 'sparkle') {
                                const hue = 230 + Math.random() * 40; // 230-270(è“ç´«è‰²èŒƒå›?
                                const saturation = 80 + Math.random() * 20; // 80%-100%
                                const lightness = 70 + Math.random() * 20; // 70%-90%
                                const brightness = 1.3 + Math.random() * 0.3;
                                
                                snowflake.style.backgroundColor = `hsl(${hue}, ${saturation}%, ${lightness}%)`;
                                snowflake.style.boxShadow = `0 0 5px hsl(${hue}, ${saturation}%, ${lightness}%)`;
                                snowflake.style.filter = `blur(0.5px) brightness(${brightness})`;
                            } else {
                                const hue = 210 + Math.random() * 30; // 210-240(è“è‰²èŒƒå›´) 
                                const saturation = 70 + Math.random() * 20; // 70%-90%
                                const lightness = 75 + Math.random() * 15; // 75%-90%
                                
                                snowflake.style.backgroundColor = `hsl(${hue}, ${saturation}%, ${lightness}%)`;
                                snowflake.style.boxShadow = `0 0 4px hsl(${hue}, ${saturation}%, ${lightness}%)`;
                            }
                        } else {
                            // ç™½é”®çˆ†å‘ä½¿ç”¨é‡‘è‰²/æš–è‰²ç³?                            if (snowflakeType === 'sparkle') {
                                const hue = 40 + Math.random() * 20; // 40-60(é‡‘è‰²èŒƒå›´)
                                const saturation = 80 + Math.random() * 20; // 80%-100%
                                const lightness = 75 + Math.random() * 15; // 75%-90%
                                const brightness = 1.2 + Math.random() * 0.3;
                                
                                snowflake.style.backgroundColor = `hsl(${hue}, ${saturation}%, ${lightness}%)`;
                                snowflake.style.boxShadow = `0 0 5px hsl(${hue}, ${saturation}%, ${lightness}%)`;
                                snowflake.style.filter = `blur(0.5px) brightness(${brightness})`;
                            }
                        }
                        
                        snowflakeContainer.appendChild(snowflake);
                        
                        // ä¸ºçˆ†å‘æ•ˆæœè®¾ç½®é€Ÿåº¦èŒƒå›´
                        // é»‘é”®çš„çˆ†å‘é›ªç²’é€Ÿåº¦æ›´å¿«
                        const speedMultiplier = isBlackKey ? 1.15 : 1.0;
                        const baseMinSpeed = (1.2 + Math.random() * 0.3) * speedMultiplier;
                        const baseMaxSpeed = (1.8 + Math.random() * 0.3) * speedMultiplier;
                        
                        // åœ¨èŒƒå›´å†…éšæœºé€‰æ‹© - ç¡®ä¿æ¯ä¸ªé›ªç²’æœ‰ä¸åŒçš„é€Ÿåº¦
                        const baseSpeed = baseMinSpeed + Math.random() * (baseMaxSpeed - baseMinSpeed);
                        
                        // åº”ç”¨å½“å‰å…¨å±€é€Ÿåº¦å› å­ - åªå½±å“åˆå§‹é€Ÿåº¦
                        const initialSpeed = baseSpeed * globalSpeedFactor;
                        
                        // ä¿å­˜ä¸ºå›ºå®šé€Ÿåº¦ï¼Œä¸éšåç»­å…¨å±€é€Ÿåº¦å˜åŒ–
                        snowflake.dataset.speed = initialSpeed.toString();
                        snowflake.dataset.fixed = "true";
                        
                        const distance = window.innerHeight + 50 - startY;
                        
                        // çˆ†å‘é›ªç²’çš„æ°´å¹³æ•£å¸?- é»‘é”®ç™½é”®ä½¿ç”¨ä¸åŒçš„æ•£å¸ƒæ–¹å¼?                        const driftMultiplier = isBlackKey ? 0.9 : 1.0; // é»‘é”®çˆ†å‘æ•£å¸ƒç¨å°
                        const horizontalDrift = (60 + Math.random() * 80) * driftMultiplier;
                        const driftDirection = startX < burstCenterX ? -1 : 1; // ä»ä¸­å¿ƒå‘ä¸¤è¾¹æ‰©æ•£
                        // é»‘é”®çˆ†å‘æ‘†åŠ¨é¢‘ç‡æ›´é«˜
                        const swayFrequency = isBlackKey ?
                            0.6 + Math.random() * 1.6 : // é»‘é”®: 0.6-2.2
                            0.5 + Math.random() * 1.5;  // ç™½é”®: 0.5-2.0
                        
                        const startTime = performance.now();
                        
                        // é›ªç²’åŠ¨ç”»å‡½æ•° - ç±»ä¼¼ä½†æœ‰æ›´å¼ºçš„çˆ†å‘æ•ˆæ?                        function animateBurstSnowflake(timestamp) {
                            const elapsed = timestamp - startTime;
                            
                            // ä½¿ç”¨ä¿å­˜çš„å›ºå®šåˆå§‹é€Ÿåº¦å’Œå…¨å±€é€Ÿåº¦å€å¢å™?                            const currentSpeed = parseFloat(snowflake.dataset.speed) * settings.speedMultiplier;
                            const adjustedDuration = distance / (currentSpeed * 50);
                            const progress = Math.min(elapsed / (adjustedDuration * 1000), 1);
                            
                            if (progress <= 1) {
                                // å‚ç›´æ–¹å‘æ˜¯åŠ é€Ÿä¸‹è½ï¼ˆå¼€å§‹æ…¢ï¼Œç„¶ååŠ é€Ÿï¼‰
                                // é»‘é”®ç™½é”®ä½¿ç”¨ä¸åŒçš„åŠ é€Ÿæ–¹å¼?                                const verticalEase = isBlackKey ? 1.15 : 1.2; // é»‘é”®çˆ†å‘ä¸‹è½æ›´çº¿æ€?                                const y = startY + distance * Math.pow(progress, verticalEase);
                                
                                // æ°´å¹³æ–¹å‘æ˜¯æ›´å¼ºçš„æ‘†åŠ¨
                                const x = startX + Math.sin(progress * Math.PI * swayFrequency * 3) * horizontalDrift * driftDirection * progress;
                                
                                // æ›´æ–°ä½ç½®
                                snowflake.style.left = `${x}px`;
                                snowflake.style.top = `${y}px`;
                                
                                // æ—‹è½¬æ•ˆæœ - é»‘é”®ç™½é”®ä½¿ç”¨ä¸åŒçš„æ—‹è½¬æ–¹å¼?                                const rotateMultiplier = isBlackKey ? 800 : 720; // é»‘é”®æ—‹è½¬æ›´å¿«
                                snowflake.style.transform = `rotate(${progress * rotateMultiplier * (Math.random() > 0.5 ? 1 : -1)}deg)`;
                                
                                // æ¥è¿‘åœ°é¢æ—¶æ¸æ¸æ¶ˆå¤?- ä½¿ç”¨å…¨å±€è®¾ç½®
                                if (progress > settings.fadeStartThreshold) {
                                    snowflake.style.opacity = `${(1 - progress) * settings.fadeMultiplier}`;
                                }
                                
                                requestAnimationFrame(animateBurstSnowflake);
                            } else {
                                // åŠ¨ç”»ç»“æŸï¼Œç§»é™¤é›ªç²?                                snowflake.remove();
                                activeSnowflakeCount = Math.max(0, activeSnowflakeCount - 1); // ç¡®ä¿ä¸ä¼šå°äº0
                            }
                        }
                        
                        // å¼€å§‹åŠ¨ç”»ï¼Œä½†ç•¥å¾®é”™å¼€æ—¶é—´
                        setTimeout(() => {
                            requestAnimationFrame(animateBurstSnowflake);
                        }, i * 30); // é›ªç²’çˆ†å‘æœ‰è½»å¾®çš„æ—¶é—´å·?                    }
                }
            }
            
            // æ·»åŠ ä¸€ä¸ªæœ€å°åŒ–ç‰ˆæœ¬çš„é›ªç²’çˆ†å‘æ•ˆæ?            function createMinimalSnowBurst(count, isBlackKey = false) {
                const pianoEl = document.querySelector('.piano-container');
                const pianoRect = pianoEl.getBoundingClientRect();
                
                for (let i = 0; i < count; i++) {
                    const snowflake = document.createElement('div');
                    activeSnowflakeCount++;
                    
                    // ä½¿ç”¨é—ªå…‰é›ªç²’ï¼Œç¡®ä¿å¯è§æ€?                    snowflake.className = 'snowflake sparkle';
                    
                    // ä»é’¢ç´ä¸Šæ–¹ä¸­å¿ƒç”Ÿæˆ?                    const centerX = pianoRect.left + (pianoRect.width * 0.5);
                    const startX = centerX - 30 + Math.random() * 60; // è¾ƒå°èŒƒå›´
                    const startY = pianoRect.top - 10 - Math.random() * 10; // è¾ƒå°èŒƒå›´
                    
                    snowflake.style.left = `${startX}px`;
                    snowflake.style.top = `${startY}px`;
                    
                    // æ ¹æ®æŒ‰é”®ç±»å‹è®¾ç½®ä¸åŒçš„é¢œè‰?                    if (isBlackKey) {
                        // é»‘é”®ä½¿ç”¨è“è‰²ç³?                        const hue = 220 + Math.random() * 40; // 220-260(è“è‰²èŒƒå›´)
                        const saturation = 75 + Math.random() * 25; // 75%-100%
                        const lightness = 70 + Math.random() * 20; // 70%-90%
                        
                        snowflake.style.backgroundColor = `hsl(${hue}, ${saturation}%, ${lightness}%)`;
                        snowflake.style.boxShadow = `0 0 4px hsl(${hue}, ${saturation}%, ${lightness}%)`;
                        snowflake.style.filter = `blur(0.5px) brightness(1.5)`;
                    } else {
                        // ç™½é”®ä½¿ç”¨é»˜è®¤çš„ç™½è‰²æˆ–æ·¡é‡‘è‰?                        const hue = 45 + Math.random() * 15; // 45-60(æ·¡é‡‘è‰²èŒƒå›?
                        const saturation = 80 + Math.random() * 20; // 80%-100%
                        const lightness = 75 + Math.random() * 15; // 75%-90%
                        
                        snowflake.style.backgroundColor = `hsl(${hue}, ${saturation}%, ${lightness}%)`;
                        snowflake.style.boxShadow = `0 0 4px hsl(${hue}, ${saturation}%, ${lightness}%)`;
                        snowflake.style.filter = `blur(0.5px) brightness(1.5)`;
                    }
                    
                    snowflakeContainer.appendChild(snowflake);
                    
                    // è¾ƒå¿«çš„ä¸‹è½é€Ÿåº¦ï¼Œé»‘é”®ç™½é”®ä½¿ç”¨ä¸åŒé€Ÿåº¦
                    const speedMultiplier = isBlackKey ? 1.1 : 1.0;
                    const baseSpeed = (1.8 + Math.random() * 0.4) * speedMultiplier;
                    const initialSpeed = baseSpeed * globalSpeedFactor;
                    
                    snowflake.dataset.speed = initialSpeed.toString();
                    snowflake.dataset.fixed = "true";
                    
                    const distance = window.innerHeight * 0.5; // åªä¸‹è½åŠä¸ªå±å¹?                    
                    // å°èŒƒå›´æ°´å¹³æ•£å¸ƒï¼Œé»‘é”®ç™½é”®ä½¿ç”¨ä¸åŒæ•£å¸ƒæ–¹å¼
                    const driftMultiplier = isBlackKey ? 0.85 : 1.0;
                    const horizontalDrift = (20 + Math.random() * 20) * driftMultiplier;
                    const driftDirection = Math.random() > 0.5 ? 1 : -1;
                    const swayFrequency = isBlackKey ? 
                        1.2 + Math.random() * 0.6 : // é»‘é”®ï¼?.2-1.8
                        1.0 + Math.random() * 0.5;  // ç™½é”®ï¼?.0-1.5
                    
                    const startTime = performance.now();
                    
                    function animateMinimalSnowflake(timestamp) {
                        const elapsed = timestamp - startTime;
                        const currentSpeed = parseFloat(snowflake.dataset.speed);
                        const adjustedDuration = distance / (currentSpeed * 50);
                        const progress = Math.min(elapsed / (adjustedDuration * 1000), 1);
                        
                        if (progress <= 1) {
                            const y = startY + distance * progress;
                            const x = startX + Math.sin(progress * Math.PI * swayFrequency) * horizontalDrift * driftDirection;
                            
                            snowflake.style.left = `${x}px`;
                            snowflake.style.top = `${y}px`;
                            snowflake.style.transform = `rotate(${progress * 360}deg)`;
                            
                            if (progress > settings.fadeStartThreshold) {
                                snowflake.style.opacity = `${(1 - progress) * settings.fadeMultiplier}`;
                            }
                            
                            requestAnimationFrame(animateMinimalSnowflake);
                        } else {
                            snowflake.remove();
                            activeSnowflakeCount = Math.max(0, activeSnowflakeCount - 1);
                        }
                    }
                    
                    requestAnimationFrame(animateMinimalSnowflake);
                }
            }
            
            // ä¿®æ”¹window.createCometOnDemandå‡½æ•°ï¼Œç¡®ä¿å³ä½¿ç§¯ç´¯äº†å¾ˆå¤šé›ªç²’ä¹Ÿèƒ½åˆ›å»ºæ–°çš„
            window.createCometOnDemand = function(isBlackKey = false) {
                // å°è¯•æ¸…ç†æ—§é›ªç²’è…¾å‡ºç©ºé—?                manageSnowflakes();
                
                // æ›´æ–°èŠ‚å¥ä¿¡æ¯
                updateRhythm();
                
                // è·å–å½“å‰å…¨å±€é€Ÿåº¦ï¼Œç”¨äºå›ºå®šé€Ÿåº¦é›ªç²’
                const currentGlobalSpeed = globalSpeedFactor;
                
                // 1. ç›´æ¥åœ¨æŒ‰é”®ä½ç½®ä¸Šæ–¹ç”Ÿæˆä¸€ä¸ªä¸»è¦é›ªç²?                // ç¡®ä¿å³ä½¿è¾¾åˆ°æœ€å¤§æ•°é‡ï¼Œä¹Ÿèƒ½ä¸ºæŒ‰é”®è§¦å‘åˆ›å»ºå°‘é‡é›ªç²?                if (activeSnowflakeCount < maxSnowflakes || maxSnowflakes - activeSnowflakeCount < 5) {
                    createSnowflake(true, false, 0.6, isBlackKey);
                }
                
                // 2. é¢å¤–ç”Ÿæˆæ•£å¸ƒçš„é›ªç²’ï¼Œæ•°é‡æ ¹æ®å½“å‰é›ªç²’æ€»æ•°è°ƒæ•´
                const remainingCapacity = maxSnowflakes - activeSnowflakeCount;
                const extraSnowflakes = Math.min(
                    remainingCapacity > 0 ? 2 + Math.floor(Math.random() * 3) : 0,
                    remainingCapacity
                );
                
                for (let i = 0; i < extraSnowflakes; i++) {
                    setTimeout(() => {
                        createSnowflake(true, false, 0.5, isBlackKey);
                    }, i * 30); // ç•¥å¾®é”™å¼€æ—¶é—´ï¼Œé€ æˆè¿ç»­ä¸‹è½çš„æ•ˆæ?                }
                
                // 3. ä»å±å¹•é¡¶éƒ¨ç”Ÿæˆé›ªç²’ï¼Œä¿è¯æ¯æ¬¡å¼¹å¥éƒ½æœ‰ä»é¡¶éƒ¨è½ä¸‹çš„é›ªç²’
                // æ•°é‡æ ¹æ®å½“å‰å®¹é‡å’ŒèŠ‚å¥é€Ÿåº¦è°ƒæ•´
                const topSnowflakesMax = Math.min(
                    2 + Math.floor(currentGlobalSpeed * 3), // é€Ÿåº¦è¶Šå¿«ï¼Œåˆ›å»ºè¶Šå¤šé›ªç²?                    Math.max(0, maxSnowflakes - activeSnowflakeCount - extraSnowflakes) // ç¡®ä¿ä¸è¶…è¿‡å‰©ä½™å®¹é‡?                );
                
                const topSnowflakes = Math.max(1, topSnowflakesMax); // è‡³å°‘åˆ›å»º1ä¸?                
                for (let i = 0; i < topSnowflakes; i++) {
                    setTimeout(() => {
                        // ä½¿ç”¨å½“å‰èŠ‚å¥å¼ºåº¦è®¡ç®—
                        const intensity = Math.min(1.0, (currentGlobalSpeed - 1.0) / 1.5);
                        createTopSnowflake(Math.max(0.3, intensity), isBlackKey); // æœ€å°å¼ºåº¦ä¸º0.3ï¼Œç¡®ä¿å¯è§æ€?                    }, i * 50 + Math.random() * 100); // é”™å¼€æ—¶é—´
                }
            };
            
            // åˆå§‹åˆ›å»ºä¸€æ‰¹é›ªç²?            for (let i = 0; i < 30; i++) {
                setTimeout(() => {
                    createSnowflake(false);
                }, i * 100); // åˆå§‹åˆ›å»ºé—´éš”è¾ƒå°ï¼Œè¿…é€Ÿå¸ƒæ»¡å±å¹?            }
            
            // å®šæœŸæ£€æŸ¥å¹¶è¡¥å……é›ªç²’ï¼Œç¡®ä¿é›ªèŠ±æ•ˆæœæŒç»?            setInterval(() => {
                // å®šæœŸç®¡ç†é›ªç²’æ•°é‡
                manageSnowflakes();
                
                // å¦‚æœé•¿æ—¶é—´æ²¡æœ‰å¼¹å¥ï¼Œå¹³æ»‘åœ°é‡ç½®é€Ÿåº¦
                const now = performance.now();
                if (lastNoteTime > 0 && now - lastNoteTime > 3000) {
                    setTargetSpeed(1.0); // å¹³æ»‘å›åˆ°æ­£å¸¸é€Ÿåº¦
                    isRhythmFast = false;
                    noteIntervals = [];
                    lastNoteTime = 0;
                }
                
                // ç¡®ä¿æŒç»­æœ‰è¶³å¤Ÿçš„é›ªç²’
                if (activeSnowflakeCount < maxSnowflakes * 0.4) {
                    // å¦‚æœé›ªç²’æ•°é‡è¿‡ä½ï¼Œåˆ›å»ºæ›´å¤šä»¥å¿«é€Ÿè¡¥å…?                    const snowflakesToCreate = Math.min(
                        8, // ä¸€æ¬¡åˆ›å»ºæ›´å¤?                        Math.floor(maxSnowflakes * 0.6 - activeSnowflakeCount) // ä¸è¶…è¿?0%çš„æœ€å¤§å®¹é‡?                    );
                    
                    for (let i = 0; i < snowflakesToCreate; i++) {
                        setTimeout(() => {
                            // å¦‚æœå½“å‰æ•°é‡ä»ç„¶ä½äºé˜ˆå€¼ï¼Œåˆ›å»ºæ–°é›ªç²?                            if (activeSnowflakeCount < maxSnowflakes * 0.6) {
                                createTopSnowflake(0.3); // ä½¿ç”¨è¾ƒä½å¼ºåº¦
                            }
                        }, i * 100 + Math.random() * 300);
                    }
                }
            }, 800); // ç¼©çŸ­æ£€æŸ¥é—´éš?        }
    </script>
</body>
</html> 
