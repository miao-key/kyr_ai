# AI图像生成API使用说明

## 🎯 功能概述

本模块实现了基于豆包AI的旅行头像生成功能，支持根据用户信息生成个性化的旅行主题头像。

## 🔧 环境配置

在项目根目录创建 `.env.local` 文件：

```env
# 豆包图像生成API端点
VITE_DOUBAO_IMAGE_API=https://ark.cn-beijing.volces.com/api/v3

# 豆包API访问密钥
VITE_DOUBAO_API_KEY=your-api-key-here
```

## 📦 API接口

### `generateTravelAvatar(prompt)`

生成旅行主题头像

**参数：**
- `prompt` (string): 用户信息描述，包含昵称、签名、等级等

**返回值：**
- Promise<string>: 头像图片的URL或Base64数据

**示例：**
```javascript
import { generateTravelAvatar } from '@/api'

const prompt = "旅行者昵称: 小王, 个性签名: 世界那么大我想去看看, 当前等级: 黄金旅行家, 旅行天数: 365天"
const avatarUrl = await generateTravelAvatar(prompt)
```

## 🎨 备用头像方案

当豆包API不可用时，系统会自动使用备用的SVG头像生成方案：

### 特色功能：
- 🌈 **7种旅行主题配色**：每种配色对应不同的旅行元素
- ✈️ **旅行图标**：飞机、地图、背包、相机、山峰、海滩、目标等
- 🎯 **个性化**：基于用户信息生成唯一的配色和图标组合
- 💎 **精美设计**：渐变背景、阴影效果、装饰元素

### 主题配色方案：
1. **蓝紫渐变** + ✈️ 飞机图标
2. **粉紫渐变** + 🗺️ 地图图标  
3. **蓝青渐变** + 🎒 背包图标
4. **绿青渐变** + 📷 相机图标
5. **粉黄渐变** + 🏔️ 山峰图标
6. **青粉渐变** + 🏖️ 海滩图标
7. **橙黄渐变** + 🎯 目标图标

## 🔄 API调用策略

系统采用多重保障策略：

1. **优先调用豆包API**：如果环境变量正确配置，优先使用豆包AI生成
2. **智能降级**：API调用失败时自动切换到备用方案
3. **用户体验优化**：无论哪种方案都能生成美观的头像

## 🛠 技术实现

### API调用流程：
```
用户点击生成头像
↓
构建专业的图像提示词
↓
尝试调用豆包API
↓
成功 → 返回AI生成的头像
失败 → 使用备用SVG头像生成器
↓
更新用户头像显示
```

### 错误处理：
- 网络错误自动重试
- API格式错误智能处理
- 超时保护机制
- 用户友好的错误提示

## 🎉 使用效果

无论是豆包AI生成还是备用方案，都能为用户提供：
- ✨ 个性化的旅行主题头像
- 🎨 符合应用风格的视觉设计
- 📱 适配圆形头像显示
- ⚡ 快速生成和加载体验

## 🔒 安全考虑

- 环境变量保护API密钥
- 客户端请求超时控制
- 错误信息脱敏处理
- 备用方案确保服务可用性